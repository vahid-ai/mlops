project: dfp
provider: local

# Registry for feature definitions
registry:
  path: data/registry.db
  cache_ttl_seconds: 60

# Offline store using Spark with LakeFS Iceberg catalog
# Tables located at: lakefs://kronodroid/dev/iceberg/kronodroid/<table_name>
offline_store:
  type: spark
  spark_conf:
    # Iceberg extensions
    spark.sql.extensions: org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
    # LakeFS Iceberg catalog (Hadoop-based)
    spark.sql.catalog.lakefs: org.apache.iceberg.spark.SparkCatalog
    spark.sql.catalog.lakefs.type: hadoop
    spark.sql.catalog.lakefs.warehouse: s3a://kronodroid/dev
    # S3A filesystem for LakeFS S3 gateway
    spark.hadoop.fs.s3a.impl: org.apache.hadoop.fs.s3a.S3AFileSystem
    spark.hadoop.fs.s3a.path.style.access: "true"
    spark.hadoop.fs.s3a.connection.ssl.enabled: "false"
    # Per-bucket config for LakeFS repository
    spark.hadoop.fs.s3a.bucket.kronodroid.endpoint: ${LAKEFS_ENDPOINT_URL}
    spark.hadoop.fs.s3a.bucket.kronodroid.access.key: ${LAKEFS_ACCESS_KEY_ID}
    spark.hadoop.fs.s3a.bucket.kronodroid.secret.key: ${LAKEFS_SECRET_ACCESS_KEY}
    # Maven packages for Iceberg + S3A (Spark 4.0 compatible)
    spark.jars.packages: org.apache.iceberg:iceberg-spark-runtime-4.0_2.13:1.10.1,org.apache.iceberg:iceberg-aws:1.10.1,org.apache.hadoop:hadoop-aws:3.4.1,software.amazon.awssdk:bundle:2.29.51

# Online store using SQLite for local development
# For production, configure Redis with proper host/port settings
online_store:
  type: sqlite
  path: data/online_store.db

# Entity key serialization (v3 recommended)
entity_key_serialization_version: 3

# Feature server configuration
feature_server:
  enabled: true
  type: local

# Flags
flags:
  alpha_features: true
  on_demand_transforms: true
