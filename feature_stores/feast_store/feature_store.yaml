project: dfp
provider: local

# Registry for feature definitions
registry:
  path: data/registry.db
  cache_ttl_seconds: 60

# Offline store using Spark with Iceberg tables on LakeFS
offline_store:
  type: spark
  # Spark configuration for Iceberg + LakeFS
  spark_conf:
    # Iceberg Spark extensions
    spark.sql.extensions: org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
    # Configure Iceberg catalog
    spark.sql.catalog.lakefs_catalog: org.apache.iceberg.spark.SparkCatalog
    spark.sql.catalog.lakefs_catalog.type: hadoop
    spark.sql.catalog.lakefs_catalog.warehouse: ${LAKEFS_WAREHOUSE:-s3a://kronodroid/main/iceberg}
    # S3A configuration for LakeFS
    spark.hadoop.fs.s3a.endpoint: ${LAKEFS_ENDPOINT_URL:-http://localhost:8000}
    spark.hadoop.fs.s3a.access.key: ${LAKEFS_ACCESS_KEY_ID}
    spark.hadoop.fs.s3a.secret.key: ${LAKEFS_SECRET_ACCESS_KEY}
    spark.hadoop.fs.s3a.path.style.access: "true"
    spark.hadoop.fs.s3a.impl: org.apache.hadoop.fs.s3a.S3AFileSystem
    spark.hadoop.fs.s3a.connection.ssl.enabled: "false"
    # Avro format for Iceberg
    spark.sql.iceberg.write.format.default: avro
    # Resource settings
    spark.driver.memory: 2g
    spark.executor.memory: 2g

# Online store using Redis for low-latency serving
online_store:
  type: redis
  connection_string: ${REDIS_CONNECTION_STRING:-redis://localhost:16379}

# Entity key serialization (version 3 is recommended)
entity_key_serialization_version: 3

# Feature server configuration
feature_server:
  enabled: true
  type: local

# Flags
flags:
  alpha_features: true
  on_demand_transforms: true
